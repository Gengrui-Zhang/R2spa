<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Corrected Standard Errors • R2spa</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Corrected Standard Errors">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">R2spa</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/R2spa.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/categorical-interaction.html">Using Two-Stage Path Analysis with Definition Variables for Latent Interactions with Categorical Indicators</a></li>
    <li><a class="dropdown-item" href="../articles/corrected-se.html">Corrected Standard Errors</a></li>
    <li><a class="dropdown-item" href="../articles/correction-error.html">Correction to Measurement Error</a></li>
    <li><a class="dropdown-item" href="../articles/efa-score.html">EFA Scores</a></li>
    <li><a class="dropdown-item" href="../articles/get_fs_int-vignette.html">get_fs_int-example</a></li>
    <li><a class="dropdown-item" href="../articles/gr-std-coef.html">Grand Standardized Coefficients</a></li>
    <li><a class="dropdown-item" href="../articles/missing-data.html">2S-PA with Missing Data</a></li>
    <li><a class="dropdown-item" href="../articles/multiple-factors.html">Multi-Factor Measurement Model</a></li>
    <li><a class="dropdown-item" href="../articles/reliability.html">Reliability of Factor Scores</a></li>
    <li><a class="dropdown-item" href="../articles/tspa-growth-vignette.html">Linear Growth Modeling with Two-Stage Path Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/tspa-plot-vignette.html">Diagnostic plots for `tspa` models</a></li>
    <li><a class="dropdown-item" href="../articles/tspa-vignette-mx.html">Multi-Factor Measurement Model (OpenMx)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Corrected Standard Errors</h1>
            
      

      <div class="d-none name"><code>corrected-se.Rmd</code></div>
    </div>

    
    
<p>This vignette shows how to obtain Taylor-series corrected standard
errors in 2S-PA, accounting for the uncertainty in the weights for
obtaining the factor scores. It is described in <a href="https://doi.org/10.1007/s00181-020-01942-z" class="external-link">this paper</a>.</p>
<p>The second-stage estimation treats as known the loading matrix and
the error covariance matrix of the factor scores as indicators of the
true latent latent variables. However, those are estimates based on the
first-stage measurement model. When the sample size is large and/or the
reliability of the factor scores are high, the uncertainty in the
estimated loading and error covariance matrix is generally negligible.
Otherwise, a first-order correction on the standard errors of the
second-stage estimation is possible, as illustrated below.</p>
<div class="section level2">
<h2 id="first-order-correction-for-se">First-order correction for SE<a class="anchor" aria-label="anchor" href="#first-order-correction-for-se"></a>
</h2>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>V</mi><mo accent="true">̂</mo></mover><mrow><mi>γ</mi><mo>,</mo><mi>c</mi></mrow></msub><mo>=</mo><msub><mover><mi>V</mi><mo accent="true">̂</mo></mover><mi>γ</mi></msub><mo>+</mo><msub><mi>𝐉</mi><mi>𝛄</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>𝛉</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><msub><mover><mi>V</mi><mo accent="true">̂</mo></mover><mi>θ</mi></msub><msub><mi>𝐉</mi><mi>𝛄</mi></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>𝛉</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mi>⊤</mi></msup><mo>,</mo></mrow><annotation encoding="application/x-tex">\hat V_{\gamma, c} = \hat V_{\gamma} + \boldsymbol{J}_\boldsymbol{\gamma}(\hat{\boldsymbol{\theta}}) \hat V_{\theta} \boldsymbol{J}_\boldsymbol{\gamma}(\hat{\boldsymbol{\theta}})^\top,</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐉</mi><mi>𝛄</mi></msub><annotation encoding="application/x-tex">\boldsymbol{J}_\boldsymbol{\gamma}</annotation></semantics></math>
is the Jacobian matrix of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>𝛄</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\boldsymbol{\gamma}}</annotation></semantics></math>
with respect to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛉</mi><annotation encoding="application/x-tex">\boldsymbol{\theta}</annotation></semantics></math>,
or</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>V</mi><mo accent="true">̂</mo></mover><mrow><mi>γ</mi><mo>,</mo><mi>c</mi></mrow></msub><mo>=</mo><msub><mover><mi>V</mi><mo accent="true">̂</mo></mover><mi>γ</mi></msub><mo>+</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝐇</mi><mi>γ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><msup><mi>∂</mi><mn>2</mn></msup><mo>ℓ</mo></mrow><mrow><mi>∂</mi><mi>θ</mi><mi>∂</mi><msup><mi>γ</mi><mi>⊤</mi></msup></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msub><mover><mi>V</mi><mo accent="true">̂</mo></mover><mi>θ</mi></msub><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><msup><mi>∂</mi><mn>2</mn></msup><mo>ℓ</mo></mrow><mrow><mi>∂</mi><mi>θ</mi><mi>∂</mi><msup><mi>γ</mi><mi>⊤</mi></msup></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>⊤</mi></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝐇</mi><mi>γ</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>,</mo></mrow><annotation encoding="application/x-tex">\hat V_{\gamma, c} = \hat V_{\gamma} + (\boldsymbol{H}_\gamma)^{-1} \left(\frac{\partial^2 \ell}{\partial \theta \partial \gamma^\top}\right) \hat V_{\theta} \left(\frac{\partial^2 \ell}{\partial \theta \partial \gamma^\top}\right)^\top (\boldsymbol{H}_\gamma)^{-1},</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>γ</mi></msub><annotation encoding="application/x-tex">V_{\gamma}</annotation></semantics></math>
is the naive covariance matrix of the structural parameter estimates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>𝛄</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\boldsymbol{\gamma}}</annotation></semantics></math>
assuming the measurement error variance parameter,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛉</mi><annotation encoding="application/x-tex">\boldsymbol{\theta}</annotation></semantics></math>,
is known,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐇</mi><mi>γ</mi></msub><annotation encoding="application/x-tex">\boldsymbol{H}_\gamma</annotation></semantics></math>
is the Hessian matrix of the log-likelihood
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>ℓ</mo><annotation encoding="application/x-tex">\ell</annotation></semantics></math>
with respect to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>𝛄</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\boldsymbol{\gamma}}</annotation></semantics></math>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mi>θ</mi></msub><annotation encoding="application/x-tex">V_{\theta}</annotation></semantics></math>
can be obtained in the first-stage measurement model analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lavaan.ugent.be" class="external-link">lavaan</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gengrui-zhang.github.io/R2spa/">R2spa</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://optimizer.r-forge.r-project.org/" class="external-link">numDeriv</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">boot</span><span class="op">)</span></span></code></pre></div>
<p>This example is based on the Political Democracy data used in <a href="https://lavaan.ugent.be/tutorial/sem.html" class="external-link uri">https://lavaan.ugent.be/tutorial/sem.html</a> and as an
example in Bollen (1989)’s book.</p>
</div>
<div class="section level2">
<h2 id="separate-measurement-models">Separate Measurement Models<a class="anchor" aria-label="anchor" href="#separate-measurement-models"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="st">'</span></span>
<span><span class="st">  # latent variable definitions</span></span>
<span><span class="st">     ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">     dem60 =~ y1 + y2 + y3 + y4</span></span>
<span><span class="st"></span></span>
<span><span class="st">  # regressions</span></span>
<span><span class="st">    dem60 ~ ind60</span></span>
<span><span class="st">'</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfa_ind60</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/cfa.html" class="external-link">cfa</a></span><span class="op">(</span><span class="st">"ind60 =~ x1 + x2 + x3"</span>, data <span class="op">=</span> <span class="va">PoliticalDemocracy</span><span class="op">)</span></span>
<span><span class="co"># Regression factor scores</span></span>
<span><span class="va">fs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fs_lavaan.html">get_fs_lavaan</a></span><span class="op">(</span><span class="va">cfa_ind60</span>, vfsLT <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Delta method variance of (loading, intercept)</span></span>
<span><span class="va">vldev1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs1</span>, which <span class="op">=</span> <span class="st">"vfsLT"</span><span class="op">)</span></span>
<span><span class="va">cfa_dem60</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/cfa.html" class="external-link">cfa</a></span><span class="op">(</span><span class="st">"dem60 =~ y1 + y2 + y3 + y4"</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">PoliticalDemocracy</span><span class="op">)</span></span>
<span><span class="co"># Regression factor scores</span></span>
<span><span class="va">fs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fs_lavaan.html">get_fs_lavaan</a></span><span class="op">(</span><span class="va">cfa_dem60</span>, vfsLT <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Delta method variance of (loading, intercept)</span></span>
<span><span class="va">vldev2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs2</span>, which <span class="op">=</span> <span class="st">"vfsLT"</span><span class="op">)</span></span>
<span><span class="va">fs_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  fs_ind60 <span class="op">=</span> <span class="va">fs1</span><span class="op">$</span><span class="va">fs_ind60</span>,</span>
<span>  fs_dem60 <span class="op">=</span> <span class="va">fs2</span><span class="op">$</span><span class="va">fs_dem60</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Combine sampling variance of loading and error variance</span></span>
<span><span class="co"># Note: loadings first, then error variance</span></span>
<span><span class="va">vldev</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_diag.html">block_diag</a></span><span class="op">(</span><span class="va">vldev1</span>, <span class="va">vldev2</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2S-PA</span></span>
<span><span class="co"># Assemble loadings</span></span>
<span><span class="va">ld</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_diag.html">block_diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs1</span>, which <span class="op">=</span> <span class="st">"fsL"</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs2</span>, which <span class="op">=</span> <span class="st">"fsL"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_diag.html">block_diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs1</span>, which <span class="op">=</span> <span class="st">"fsT"</span><span class="op">)</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs2</span>, which <span class="op">=</span> <span class="st">"fsT"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tspa_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tspa.html">tspa</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"dem60 ~ ind60"</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">fs_dat</span>,</span>
<span>                 fsL <span class="op">=</span> <span class="va">ld</span>,</span>
<span>                 fsT <span class="op">=</span> <span class="va">ev</span><span class="op">)</span></span>
<span><span class="co"># Unadjusted covariance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">tspa_fit</span><span class="op">)</span></span>
<span><span class="co">#&gt;              d60~60 i60~~6 d60~~6</span></span>
<span><span class="co">#&gt; dem60~ind60   0.131              </span></span>
<span><span class="co">#&gt; ind60~~ind60 -0.001  0.006       </span></span>
<span><span class="co">#&gt; dem60~~dem60 -0.006  0.000  0.477</span></span>
<span><span class="co"># Adjusted covariance matrix</span></span>
<span><span class="op">(</span><span class="va">vc_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcov_corrected.html">vcov_corrected</a></span><span class="op">(</span><span class="va">tspa_fit</span>, vfsLT <span class="op">=</span> <span class="va">vldev</span>, which_free <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;              d60~60 i60~~6 d60~~6</span></span>
<span><span class="co">#&gt; dem60~ind60   0.133              </span></span>
<span><span class="co">#&gt; ind60~~ind60 -0.001  0.006       </span></span>
<span><span class="co">#&gt; dem60~~dem60  0.001  0.000  0.518</span></span>
<span><span class="co"># Corrected standard errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">vc_cor</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  dem60~ind60 ind60~~ind60 dem60~~dem60 </span></span>
<span><span class="co">#&gt;   0.36415174   0.07585532   0.71996886</span></span></code></pre></div>
<p>Standardized solution</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tspa_est_std</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ld_ev</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ld1</span> <span class="op">&lt;-</span> <span class="va">ld</span></span>
<span>  <span class="va">ev1</span> <span class="op">&lt;-</span> <span class="va">ev</span></span>
<span>  <span class="va">ld1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ld_ev</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">ev1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ld_ev</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="va">tfit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tspa.html">tspa</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"dem60 ~ ind60"</span>,</span>
<span>               data <span class="op">=</span> <span class="va">fs_dat</span>,</span>
<span>               fsL <span class="op">=</span> <span class="va">ld1</span>,</span>
<span>               fsT <span class="op">=</span> <span class="va">ev1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/standardizedSolution.html" class="external-link">standardizedSolution</a></span><span class="op">(</span><span class="va">tfit</span><span class="op">)</span><span class="op">$</span><span class="va">est.std</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">tspa_est_std</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ld</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>, <span class="va">ev</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4531693</span></span>
<span><span class="co"># Jacobian</span></span>
<span><span class="va">jac_std</span> <span class="op">&lt;-</span> <span class="fu">numDeriv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/jacobian.html" class="external-link">jacobian</a></span><span class="op">(</span><span class="va">tspa_est_std</span>,</span>
<span>                              x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ld</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span>, <span class="va">ev</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Corrected standard error</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/standardizedSolution.html" class="external-link">standardizedSolution</a></span><span class="op">(</span><span class="va">tspa_fit</span><span class="op">)</span><span class="op">[</span><span class="fl">8</span>, <span class="st">"se"</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span></span>
<span>    <span class="va">jac_std</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">vldev</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">jac_std</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]</span></span>
<span><span class="co">#&gt; [1,] 0.1013887</span></span></code></pre></div>
<p>Compare to joint structural and measurement model</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sem_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span><span class="va">model</span>, data <span class="op">=</span> <span class="va">PoliticalDemocracy</span><span class="op">)</span></span>
<span><span class="co"># Larger standard error</span></span>
<span><span class="op">(</span><span class="va">vc_j</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">sem_fit</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dem60~ind60"</span>, <span class="st">"ind60~~ind60"</span>, <span class="st">"dem60~~dem60"</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dem60~ind60"</span>, <span class="st">"ind60~~ind60"</span>, <span class="st">"dem60~~dem60"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;               dem60~ind60  ind60~~ind60  dem60~~dem60</span></span>
<span><span class="co">#&gt; dem60~ind60   0.143355743 -0.0033833569  0.0648673299</span></span>
<span><span class="co">#&gt; ind60~~ind60 -0.003383357  0.0075268147 -0.0001098306</span></span>
<span><span class="co">#&gt; dem60~~dem60  0.064867330 -0.0001098306  0.7655699561</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">vc_j</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  dem60~ind60 ind60~~ind60 dem60~~dem60 </span></span>
<span><span class="co">#&gt;   0.37862348   0.08675722   0.87496855</span></span></code></pre></div>
<p>Bootstrap Standard Errors</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run_tspa</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">inds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fs_ind60</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fs.html">get_fs</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="va">inds</span>, <span class="op">]</span>, model <span class="op">=</span> <span class="st">"ind60 =~ x1 + x2 + x3"</span>,</span>
<span>                     se <span class="op">=</span> <span class="st">"none"</span>, test <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>  <span class="va">fs_dem60</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fs.html">get_fs</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="va">inds</span>, <span class="op">]</span>, model <span class="op">=</span> <span class="st">"dem60 =~ y1 + y2 + y3 + y4"</span>,</span>
<span>                     se <span class="op">=</span> <span class="st">"none"</span>, test <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>  <span class="va">fs_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">fs_ind60</span>, <span class="va">fs_dem60</span><span class="op">)</span></span>
<span>  <span class="co"># Assemble loadings</span></span>
<span>  <span class="va">ld</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_diag.html">block_diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs_ind60</span>, which <span class="op">=</span> <span class="st">"fsL"</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs_dem60</span>, which <span class="op">=</span> <span class="st">"fsL"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">ev</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/block_diag.html">block_diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs_ind60</span>, which <span class="op">=</span> <span class="st">"fsT"</span><span class="op">)</span>,</span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs_dem60</span>, which <span class="op">=</span> <span class="st">"fsT"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">tspa_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tspa.html">tspa</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"dem60 ~ ind60"</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">fs_dat</span>,</span>
<span>                   fsL <span class="op">=</span> <span class="va">ld</span>,</span>
<span>                   fsT <span class="op">=</span> <span class="va">ev</span>,</span>
<span>                   test <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">tspa_fit</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">boo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.html" class="external-link">boot</a></span><span class="op">(</span><span class="va">PoliticalDemocracy</span>, statistic <span class="op">=</span> <span class="va">run_tspa</span>, R <span class="op">=</span> <span class="fl">1999</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use MAD to downweigh outlying replications</span></span>
<span><span class="va">boo</span><span class="op">$</span><span class="va">t</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>MARGIN <span class="op">=</span> <span class="fl">2</span>, FUN <span class="op">=</span> <span class="va">mad</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dem60~ind60"</span>, <span class="st">"ind60~~ind60"</span>, <span class="st">"dem60~~dem60"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  dem60~ind60 ind60~~ind60 dem60~~dem60 </span></span>
<span><span class="co">#&gt;   0.32521386   0.07271009   0.87676911</span></span></code></pre></div>
<p>The standard errors seem to diverge slightly among methods.
SE(<code>dem60~ind60</code>) with bootstrap is the lowest.
SE(<code>ind60~~ind60</code>) with the joint model is particularly
higher than the other two. SE(<code>dem60~~dem60</code>) is the lowest
with the corrected 2S-PA. It should be pointed out that the joint model
and 2S-PA are different estimators.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run_sem</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">inds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sem_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/sem.html" class="external-link">sem</a></span><span class="op">(</span><span class="va">model</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">[</span><span class="va">inds</span>, <span class="op">]</span>, se <span class="op">=</span> <span class="st">"none"</span>, test <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">sem_fit</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">boo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.html" class="external-link">boot</a></span><span class="op">(</span><span class="va">PoliticalDemocracy</span>, statistic <span class="op">=</span> <span class="va">run_sem</span>, R <span class="op">=</span> <span class="fl">999</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="joint-measurement-model">Joint Measurement Model<a class="anchor" aria-label="anchor" href="#joint-measurement-model"></a>
</h2>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfa_joint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/cfa.html" class="external-link">cfa</a></span><span class="op">(</span><span class="st">"ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">                  dem60 =~ y1 + y2 + y3 + y4"</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">PoliticalDemocracy</span><span class="op">)</span></span>
<span><span class="co"># Factor score</span></span>
<span><span class="va">fs_joint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fs_lavaan.html">get_fs_lavaan</a></span><span class="op">(</span><span class="va">cfa_joint</span>, vfsLT <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Delta method variance</span></span>
<span><span class="va">vldev_joint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs_joint</span>, which <span class="op">=</span> <span class="st">"vfsLT"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tspa_fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tspa.html">tspa</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"dem60 ~ ind60"</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">fs_joint</span>,</span>
<span>                  fsT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs_joint</span>, <span class="st">"fsT"</span><span class="op">)</span>,</span>
<span>                  fsL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs_joint</span>, <span class="st">"fsL"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unadjusted covariance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">tspa_fit2</span><span class="op">)</span></span>
<span><span class="co">#&gt;              d60~60 i60~~6 d60~~6</span></span>
<span><span class="co">#&gt; dem60~ind60   0.124              </span></span>
<span><span class="co">#&gt; ind60~~ind60 -0.001  0.006       </span></span>
<span><span class="co">#&gt; dem60~~dem60 -0.006  0.000  0.430</span></span>
<span><span class="co"># Adjusted covariance</span></span>
<span><span class="op">(</span><span class="va">vc2_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcov_corrected.html">vcov_corrected</a></span><span class="op">(</span><span class="va">tspa_fit2</span>, vfsLT <span class="op">=</span> <span class="va">vldev_joint</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;              d60~60 i60~~6 d60~~6</span></span>
<span><span class="co">#&gt; dem60~ind60   0.130              </span></span>
<span><span class="co">#&gt; ind60~~ind60 -0.001  0.006       </span></span>
<span><span class="co">#&gt; dem60~~dem60 -0.009  0.000  0.493</span></span>
<span><span class="co"># Corrected standard errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">vc2_cor</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  dem60~ind60 ind60~~ind60 dem60~~dem60 </span></span>
<span><span class="co">#&gt;   0.36049260   0.07654824   0.70229676</span></span></code></pre></div>
<p>Bootstrap Standard Errors</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run_tspa2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">inds</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">fs_joint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fs.html">get_fs</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">inds</span>, <span class="op">]</span>,</span>
<span>                     model <span class="op">=</span> <span class="st">"ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">                              dem60 =~ y1 + y2 + y3 + y4"</span>,</span>
<span>                     se <span class="op">=</span> <span class="st">"none"</span>, test <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>  <span class="va">tspa_fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tspa.html">tspa</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"dem60 ~ ind60"</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">fs_joint</span>,</span>
<span>                    fsT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs_joint</span>, <span class="st">"fsT"</span><span class="op">)</span>,</span>
<span>                    fsL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs_joint</span>, <span class="st">"fsL"</span><span class="op">)</span>,</span>
<span>                    test <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">tspa_fit2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">boo2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/boot/man/boot.html" class="external-link">boot</a></span><span class="op">(</span><span class="va">PoliticalDemocracy</span>, statistic <span class="op">=</span> <span class="va">run_tspa2</span>, R <span class="op">=</span> <span class="fl">1999</span><span class="op">)</span></span>
<span><span class="co"># run_tspa2b &lt;- function(df, inds) {</span></span>
<span><span class="co">#   fsb_joint &lt;- get_fs(df[inds, ],</span></span>
<span><span class="co">#                       model = "ind60 =~ x1 + x2 + x3</span></span>
<span><span class="co">#                               dem60 =~ y1 + y2 + y3 + y4",</span></span>
<span><span class="co">#                       se = "none", test = "none", method = "Bartlett")</span></span>
<span><span class="co">#   tspa_fit2b &lt;- tspa(model = "dem60 ~ ind60",</span></span>
<span><span class="co">#                      data = fsb_joint,</span></span>
<span><span class="co">#                      fsT = attr(fsb_joint, "fsT"),</span></span>
<span><span class="co">#                      fsL = diag(2),</span></span>
<span><span class="co">#                      test = "none")</span></span>
<span><span class="co">#   coef(tspa_fit2b)</span></span>
<span><span class="co"># }</span></span>
<span><span class="co"># boo2b &lt;- boot(PoliticalDemocracy, statistic = run_tspa2b, R = 4999)</span></span>
<span><span class="co"># run_sem2 &lt;- function(df, inds) {</span></span>
<span><span class="co">#   sem_fit &lt;- sem(model, data = df[inds, ])</span></span>
<span><span class="co">#   coef(sem_fit)[c(6, 14, 15)]</span></span>
<span><span class="co"># }</span></span>
<span><span class="co"># boo2j &lt;- boot(PoliticalDemocracy, statistic = run_sem2, R = 4999)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use MAD to downweigh outlying replications</span></span>
<span><span class="va">boo2</span><span class="op">$</span><span class="va">t</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span>MARGIN <span class="op">=</span> <span class="fl">2</span>, FUN <span class="op">=</span> <span class="va">mad</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dem60~ind60"</span>, <span class="st">"ind60~~ind60"</span>, <span class="st">"dem60~~dem60"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  dem60~ind60 ind60~~ind60 dem60~~dem60 </span></span>
<span><span class="co">#&gt;   0.34364943   0.07851415   0.88168143</span></span></code></pre></div>
<div class="section level3">
<h3 id="with-bartletts-method">With Bartlett’s Method<a class="anchor" aria-label="anchor" href="#with-bartletts-method"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Factor score</span></span>
<span><span class="va">fsb_joint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fs.html">get_fs</a></span><span class="op">(</span><span class="va">PoliticalDemocracy</span>,</span>
<span>                    model <span class="op">=</span> <span class="st">"ind60 =~ x1 + x2 + x3</span></span>
<span><span class="st">                             dem60 =~ y1 + y2 + y3 + y4"</span>,</span>
<span>                    method <span class="op">=</span> <span class="st">"Bartlett"</span>,</span>
<span>                    vfsLT <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">vldevb_joint</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fsb_joint</span>, which <span class="op">=</span> <span class="st">"vfsLT"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tspa_fit2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tspa.html">tspa</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"dem60 ~ ind60"</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">fsb_joint</span>,</span>
<span>                   fsT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fsb_joint</span>, <span class="st">"fsT"</span><span class="op">)</span>,</span>
<span>                   fsL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                       <span class="fu">`dimnames&lt;-`</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fs_ind60"</span>, <span class="st">"fs_dem60"</span><span class="op">)</span>,</span>
<span>                                         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ind60"</span>, <span class="st">"dem60"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unadjusted covariance matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">tspa_fit2b</span><span class="op">)</span></span>
<span><span class="co">#&gt;              d60~60 i60~~6 d60~~6</span></span>
<span><span class="co">#&gt; dem60~ind60   0.124              </span></span>
<span><span class="co">#&gt; ind60~~ind60 -0.001  0.006       </span></span>
<span><span class="co">#&gt; dem60~~dem60 -0.006  0.000  0.430</span></span>
<span><span class="co"># Adjusted covariance matrix</span></span>
<span><span class="op">(</span><span class="va">vc2b_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vcov_corrected.html">vcov_corrected</a></span><span class="op">(</span></span>
<span>    <span class="va">tspa_fit2b</span>,</span>
<span>    <span class="co"># Exclude fixed loadings and error variance</span></span>
<span>    vfsLT <span class="op">=</span> <span class="va">vldevb_joint</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="co"># Specify which elements are free (error variances only)</span></span>
<span>    which_free <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;              d60~60 i60~~6 d60~~6</span></span>
<span><span class="co">#&gt; dem60~ind60   0.124              </span></span>
<span><span class="co">#&gt; ind60~~ind60 -0.001  0.006       </span></span>
<span><span class="co">#&gt; dem60~~dem60 -0.006  0.000  0.448</span></span>
<span><span class="co"># Corrected standard errors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">vc2b_cor</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  dem60~ind60 ind60~~ind60 dem60~~dem60 </span></span>
<span><span class="co">#&gt;   0.35271752   0.07634634   0.66959806</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="multiple-groups">Multiple Groups<a class="anchor" aria-label="anchor" href="#multiple-groups"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Multigroup, three-factor example</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">  # latent variables</span></span>
<span><span class="st">    visual =~ x1 + x2 + x3</span></span>
<span><span class="st">    textual =~ x4 + x5 + x6</span></span>
<span><span class="st">    speed =~ x7 + x8 + x9</span></span>
<span><span class="st">"</span></span>
<span><span class="co"># Factor scores based on partial invariance</span></span>
<span><span class="va">fs_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fs.html">get_fs</a></span><span class="op">(</span><span class="va">HolzingerSwineford1939</span>, model <span class="op">=</span> <span class="va">mod</span>, std.lv <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 group <span class="op">=</span> <span class="st">"school"</span>,</span>
<span>                 group.equal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loadings"</span>, <span class="st">"intercepts"</span><span class="op">)</span>,</span>
<span>                 group.partial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"visual=~x2"</span>, <span class="st">"x7~1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lavaan/man/cfa.html" class="external-link">cfa</a></span><span class="op">(</span><span class="va">mod</span>,</span>
<span>           data <span class="op">=</span> <span class="va">HolzingerSwineford1939</span>,</span>
<span>           std.lv <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>           group <span class="op">=</span> <span class="st">"school"</span>,</span>
<span>           group.equal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loadings"</span>, <span class="st">"intercepts"</span><span class="op">)</span>,</span>
<span>           group.partial <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"visual=~x2"</span>, <span class="st">"x7~1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fs_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fs_lavaan.html">get_fs_lavaan</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="va">vldev</span> <span class="op">&lt;-</span> <span class="fu">R2spa</span><span class="fu">:::</span><span class="fu">vcov_ld_evfs</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tspa_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tspa.html">tspa</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"visual ~~ textual + speed</span></span>
<span><span class="st">                          textual ~~ speed"</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">fs_dat</span>,</span>
<span>                 group <span class="op">=</span> <span class="st">"school"</span>,</span>
<span>                 fsL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs_dat</span>, which <span class="op">=</span> <span class="st">"fsL"</span><span class="op">)</span>,</span>
<span>                 fsT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">fs_dat</span>, which <span class="op">=</span> <span class="st">"fsT"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Unadjusted covariance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">tspa_fit</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;                     visual~~textual visual~~speed textual~~speed visual~~visual</span></span>
<span><span class="co">#&gt; visual~~textual         0.012032756   0.004143016    0.003562702    0.009059744</span></span>
<span><span class="co">#&gt; visual~~speed           0.004143016   0.015289623    0.005749677    0.006286186</span></span>
<span><span class="co">#&gt; textual~~speed          0.003562702   0.005749677    0.012308431    0.002169626</span></span>
<span><span class="co">#&gt; visual~~visual          0.009059744   0.006286186    0.002169626    0.026249333</span></span>
<span><span class="co">#&gt; textual~~textual        0.007226793   0.002111028    0.004878946    0.003126897</span></span>
<span><span class="co">#&gt; speed~~speed            0.001464756   0.006962597    0.006774549    0.001505415</span></span>
<span><span class="co">#&gt; visual~~textual.g2      0.000000000   0.000000000    0.000000000    0.000000000</span></span>
<span><span class="co">#&gt; visual~~speed.g2        0.000000000   0.000000000    0.000000000    0.000000000</span></span>
<span><span class="co">#&gt; textual~~speed.g2       0.000000000   0.000000000    0.000000000    0.000000000</span></span>
<span><span class="co">#&gt; visual~~visual.g2       0.000000000   0.000000000    0.000000000    0.000000000</span></span>
<span><span class="co">#&gt; textual~~textual.g2     0.000000000   0.000000000    0.000000000    0.000000000</span></span>
<span><span class="co">#&gt; speed~~speed.g2         0.000000000   0.000000000    0.000000000    0.000000000</span></span>
<span><span class="co">#&gt;                     textual~~textual speed~~speed visual~~textual.g2</span></span>
<span><span class="co">#&gt; visual~~textual          0.007226793  0.001464756        0.000000000</span></span>
<span><span class="co">#&gt; visual~~speed            0.002111028  0.006962597        0.000000000</span></span>
<span><span class="co">#&gt; textual~~speed           0.004878946  0.006774549        0.000000000</span></span>
<span><span class="co">#&gt; visual~~visual           0.003126897  0.001505415        0.000000000</span></span>
<span><span class="co">#&gt; textual~~textual         0.016702352  0.001425195        0.000000000</span></span>
<span><span class="co">#&gt; speed~~speed             0.001425195  0.032202255        0.000000000</span></span>
<span><span class="co">#&gt; visual~~textual.g2       0.000000000  0.000000000        0.011424159</span></span>
<span><span class="co">#&gt; visual~~speed.g2         0.000000000  0.000000000        0.005834597</span></span>
<span><span class="co">#&gt; textual~~speed.g2        0.000000000  0.000000000        0.006283615</span></span>
<span><span class="co">#&gt; visual~~visual.g2        0.000000000  0.000000000        0.008537899</span></span>
<span><span class="co">#&gt; textual~~textual.g2      0.000000000  0.000000000        0.007689097</span></span>
<span><span class="co">#&gt; speed~~speed.g2          0.000000000  0.000000000        0.003681750</span></span>
<span><span class="co">#&gt;                     visual~~speed.g2 textual~~speed.g2 visual~~visual.g2</span></span>
<span><span class="co">#&gt; visual~~textual          0.000000000       0.000000000       0.000000000</span></span>
<span><span class="co">#&gt; visual~~speed            0.000000000       0.000000000       0.000000000</span></span>
<span><span class="co">#&gt; textual~~speed           0.000000000       0.000000000       0.000000000</span></span>
<span><span class="co">#&gt; visual~~visual           0.000000000       0.000000000       0.000000000</span></span>
<span><span class="co">#&gt; textual~~textual         0.000000000       0.000000000       0.000000000</span></span>
<span><span class="co">#&gt; speed~~speed             0.000000000       0.000000000       0.000000000</span></span>
<span><span class="co">#&gt; visual~~textual.g2       0.005834597       0.006283615       0.008537899</span></span>
<span><span class="co">#&gt; visual~~speed.g2         0.020016361       0.008699815       0.010689107</span></span>
<span><span class="co">#&gt; textual~~speed.g2        0.008699815       0.016930572       0.004219633</span></span>
<span><span class="co">#&gt; visual~~visual.g2        0.010689107       0.004219633       0.021628068</span></span>
<span><span class="co">#&gt; textual~~textual.g2      0.002940790       0.006708957       0.003370422</span></span>
<span><span class="co">#&gt; speed~~speed.g2          0.017174234       0.011969242       0.005282811</span></span>
<span><span class="co">#&gt;                     textual~~textual.g2 speed~~speed.g2</span></span>
<span><span class="co">#&gt; visual~~textual             0.000000000     0.000000000</span></span>
<span><span class="co">#&gt; visual~~speed               0.000000000     0.000000000</span></span>
<span><span class="co">#&gt; textual~~speed              0.000000000     0.000000000</span></span>
<span><span class="co">#&gt; visual~~visual              0.000000000     0.000000000</span></span>
<span><span class="co">#&gt; textual~~textual            0.000000000     0.000000000</span></span>
<span><span class="co">#&gt; speed~~speed                0.000000000     0.000000000</span></span>
<span><span class="co">#&gt; visual~~textual.g2          0.007689097     0.003681750</span></span>
<span><span class="co">#&gt; visual~~speed.g2            0.002940790     0.017174234</span></span>
<span><span class="co">#&gt; textual~~speed.g2           0.006708957     0.011969242</span></span>
<span><span class="co">#&gt; visual~~visual.g2           0.003370422     0.005282811</span></span>
<span><span class="co">#&gt; textual~~textual.g2         0.017541486     0.002565923</span></span>
<span><span class="co">#&gt; speed~~speed.g2             0.002565923     0.055832832</span></span>
<span><span class="co"># Adjusted covariance</span></span>
<span><span class="fu"><a href="../reference/vcov_corrected.html">vcov_corrected</a></span><span class="op">(</span><span class="va">tspa_fit</span>, vfsLT <span class="op">=</span> <span class="va">vldev</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">10</span><span class="op">:</span><span class="fl">15</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt;                     visual~~textual visual~~speed textual~~speed visual~~visual</span></span>
<span><span class="co">#&gt; visual~~textual        1.766770e-02  3.948995e-03   1.680095e-03   0.0032658891</span></span>
<span><span class="co">#&gt; visual~~speed          3.948995e-03  2.625930e-02   6.180231e-03  -0.0002941259</span></span>
<span><span class="co">#&gt; textual~~speed         1.680095e-03  6.180231e-03   2.088330e-02   0.0034032016</span></span>
<span><span class="co">#&gt; visual~~visual         3.265889e-03 -2.941259e-04   3.403202e-03   0.0552337485</span></span>
<span><span class="co">#&gt; textual~~textual       6.343722e-03  3.471197e-03   4.310592e-03   0.0022325897</span></span>
<span><span class="co">#&gt; speed~~speed           2.319057e-03 -2.462920e-04   2.977648e-03   0.0039800365</span></span>
<span><span class="co">#&gt; visual~~textual.g2     2.894521e-04 -1.727969e-05  -1.158344e-04  -0.0036750998</span></span>
<span><span class="co">#&gt; visual~~speed.g2      -7.758231e-05  4.463544e-04  -3.159286e-04  -0.0017771299</span></span>
<span><span class="co">#&gt; textual~~speed.g2     -1.395251e-04 -2.939691e-05   1.074132e-04   0.0021179697</span></span>
<span><span class="co">#&gt; visual~~visual.g2      6.773687e-04  9.416669e-05  -5.286419e-04  -0.0139631267</span></span>
<span><span class="co">#&gt; textual~~textual.g2   -8.773851e-05  1.870183e-04  -5.236929e-05   0.0001038840</span></span>
<span><span class="co">#&gt; speed~~speed.g2       -3.614222e-04  2.154682e-04   1.739917e-04   0.0030238026</span></span>
<span><span class="co">#&gt;                     textual~~textual  speed~~speed visual~~textual.g2</span></span>
<span><span class="co">#&gt; visual~~textual         6.343722e-03  2.319057e-03       2.894521e-04</span></span>
<span><span class="co">#&gt; visual~~speed           3.471197e-03 -2.462920e-04      -1.727969e-05</span></span>
<span><span class="co">#&gt; textual~~speed          4.310592e-03  2.977648e-03      -1.158344e-04</span></span>
<span><span class="co">#&gt; visual~~visual          2.232590e-03  3.980036e-03      -3.675100e-03</span></span>
<span><span class="co">#&gt; textual~~textual        1.943788e-02 -2.260608e-05       3.559274e-04</span></span>
<span><span class="co">#&gt; speed~~speed           -2.260608e-05  5.904050e-02       1.853678e-03</span></span>
<span><span class="co">#&gt; visual~~textual.g2      3.559274e-04  1.853678e-03       2.079770e-02</span></span>
<span><span class="co">#&gt; visual~~speed.g2       -8.758319e-04  3.799116e-03       7.128677e-03</span></span>
<span><span class="co">#&gt; textual~~speed.g2      -2.295514e-05 -2.136909e-03       2.631124e-03</span></span>
<span><span class="co">#&gt; visual~~visual.g2       1.246137e-03  2.827516e-03       1.425193e-02</span></span>
<span><span class="co">#&gt; textual~~textual.g2    -2.028541e-04 -1.070262e-03       5.734502e-03</span></span>
<span><span class="co">#&gt; speed~~speed.g2         7.282334e-04 -1.578688e-02       3.266464e-04</span></span>
<span><span class="co">#&gt;                     visual~~speed.g2 textual~~speed.g2 visual~~visual.g2</span></span>
<span><span class="co">#&gt; visual~~textual        -7.758231e-05     -1.395251e-04      6.773687e-04</span></span>
<span><span class="co">#&gt; visual~~speed           4.463544e-04     -2.939691e-05      9.416669e-05</span></span>
<span><span class="co">#&gt; textual~~speed         -3.159286e-04      1.074132e-04     -5.286419e-04</span></span>
<span><span class="co">#&gt; visual~~visual         -1.777130e-03      2.117970e-03     -1.396313e-02</span></span>
<span><span class="co">#&gt; textual~~textual       -8.758319e-04     -2.295514e-05      1.246137e-03</span></span>
<span><span class="co">#&gt; speed~~speed            3.799116e-03     -2.136909e-03      2.827516e-03</span></span>
<span><span class="co">#&gt; visual~~textual.g2      7.128677e-03      2.631124e-03      1.425193e-02</span></span>
<span><span class="co">#&gt; visual~~speed.g2        3.246016e-02      6.793932e-03      8.478633e-03</span></span>
<span><span class="co">#&gt; textual~~speed.g2       6.793932e-03      2.230005e-02     -7.599378e-04</span></span>
<span><span class="co">#&gt; visual~~visual.g2       8.478633e-03     -7.599378e-04      1.079909e-01</span></span>
<span><span class="co">#&gt; textual~~textual.g2     4.641147e-03      6.987265e-03      4.758042e-04</span></span>
<span><span class="co">#&gt; speed~~speed.g2         6.636008e-03      1.596428e-02     -3.656654e-03</span></span>
<span><span class="co">#&gt;                     textual~~textual.g2 speed~~speed.g2</span></span>
<span><span class="co">#&gt; visual~~textual           -8.773851e-05   -0.0003614222</span></span>
<span><span class="co">#&gt; visual~~speed              1.870183e-04    0.0002154682</span></span>
<span><span class="co">#&gt; textual~~speed            -5.236929e-05    0.0001739917</span></span>
<span><span class="co">#&gt; visual~~visual             1.038840e-04    0.0030238026</span></span>
<span><span class="co">#&gt; textual~~textual          -2.028541e-04    0.0007282334</span></span>
<span><span class="co">#&gt; speed~~speed              -1.070262e-03   -0.0157868803</span></span>
<span><span class="co">#&gt; visual~~textual.g2         5.734502e-03    0.0003266464</span></span>
<span><span class="co">#&gt; visual~~speed.g2           4.641147e-03    0.0066360081</span></span>
<span><span class="co">#&gt; textual~~speed.g2          6.987265e-03    0.0159642788</span></span>
<span><span class="co">#&gt; visual~~visual.g2          4.758042e-04   -0.0036566537</span></span>
<span><span class="co">#&gt; textual~~textual.g2        2.062776e-02    0.0018416930</span></span>
<span><span class="co">#&gt; speed~~speed.g2            1.841693e-03    0.1076812729</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Hok Chio Lai, Yixiao Li, Winnie Wing-Yee Tse, Gengrui Zhang Zhang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
